generate_configs:
  cmd: python -m spacy run generate_configs
  script:
    - python -m spacy init config configs/config.gpu.base.cfg -F --lang en --pipeline
      textcat --optimize accuracy --gpu
    - python -m spacy init config configs/config.cpu.base.cfg -F --lang en --pipeline
      textcat --optimize efficiency
    - python -m spacy init config configs/config.cpu.acc.cfg -F --lang en --pipeline
      textcat --optimize accuracy
    - cp configs/config.gpu.base.cfg configs/config.gpu.setfit.cfg
    - sed -i'' -e 's,name = .*,name = "models/sst_setfit",g' configs/config.gpu.setfit.cfg
    - find configs/ -type f -name '*.cfg' -exec sed -i'' -e 's,max_epochs = .*,max_epochs
      = 100,g' {} +
    - find configs/ -type f -name '*.cfg' -exec sed -i'' -e 's,eval_frequency = .*,eval_frequency
      = 100,g' {} +
    - find configs/ -type f -name '*.cfg' -exec python scripts/replace_config_section.py
      configs/wandb.template {} \;
    - find configs/ -type f -name '*.cfg-e' -exec rm {} +
  deps: []
  outs:
    - path: configs/config.cpu.base.cfg
      md5: 0f01b78a344b020a176a48d37bfb174f
    - path: configs/config.cpu.acc.cfg
      md5: 3bd70f288776c468a475289cd0a103d9
    - path: configs/config.gpu.base.cfg
      md5: 4b5c33849c2dd949dab553ea97c3918d
    - path: configs/config.gpu.setfit.cfg
      md5: 0bf1e293fb58ee265e520cd5955dff0f
  spacy_version: 3.2.1
  spacy_git_version: 800737b41
preprocess:
  cmd: python -m spacy run preprocess
  script:
    - python scripts/process_data.py assets/sst-train-raw.tsv corpus/train.spacy --sample=128
      --seed=1234
    - python scripts/process_data.py assets/sst-dev-raw.tsv corpus/dev.spacy
  deps: []
  outs:
    - path: corpus/train.spacy
      md5: 2000bb1f7518bd15e55bc87d191c0607
    - path: corpus/dev.spacy
      md5: f4f31c9a17d1cb8c81883b3d9f8df1d3
  spacy_version: 3.2.1
  spacy_git_version: 800737b41
pretrain_setfit:
  cmd: python -m spacy run pretrain_setfit
  script:
    - python scripts/train_setfit.py sentence-transformers/all-mpnet-base-v2 sst_setfit
      train.spacy
  deps:
    - path: train.spacy
      md5: 2000bb1f7518bd15e55bc87d191c0607
  outs: []
  spacy_version: 3.2.1
  spacy_git_version: 800737b41
train_cpu:
  cmd: python -m spacy run train_cpu
  script:
    - python -m spacy train configs/config.cpu.base.cfg --paths.train train.spacy
      --paths.dev dev.spacy --output training-cpu-efficiency/
  deps:
    - path: configs/config.cpu.base.cfg
      md5: 1d0e52a72697ca44cd478d7dd2335451
    - path: train.spacy
      md5: 2000bb1f7518bd15e55bc87d191c0607
    - path: dev.spacy
      md5: f4f31c9a17d1cb8c81883b3d9f8df1d3
  outs: []
  spacy_version: 3.2.1
  spacy_git_version: 800737b41
train_cpu_acc:
  cmd: python -m spacy run train_cpu_acc
  script:
    - python -m spacy train configs/config.cpu.acc.cfg --paths.train train.spacy --paths.dev
      dev.spacy --output training-cpu-accuracy/
  deps:
    - path: configs/config.cpu.acc.cfg
      md5: 7c71f32fd0ba9d16027f1ed493d1a26a
    - path: train.spacy
      md5: 2000bb1f7518bd15e55bc87d191c0607
    - path: dev.spacy
      md5: f4f31c9a17d1cb8c81883b3d9f8df1d3
  outs: []
  spacy_version: 3.2.1
  spacy_git_version: 800737b41
